{
    "scopeName" : "source.algoritmik",
    "patterns" : [
        { "include": "#main"}
    ],
    "repository" : {
        "main" : {
            "patterns" : [
                { "include": "#program-section"},
                { "include": "#function-procedure-section"},
                { "include": "#kamus-section"},
                { "include": "#algoritma-section"},
                { "include": "#comment"}
                
            ]
        },
        "comment" : {
            "begin": "\\{",
            "end": "\\}",
            "name" : "comment.block.algoritmik",
            "beginCaptures": {
                "0": { "name": "punctuation.curlp.open" }
            },
            "endCaptures": {
                "0": { "name": "punctuation.curlp.close" }
            }
        },

        "program-section" : {
            "patterns": [
                { "include": "#program-block" }
            ],
            "repository": {
                "program-block" : {
                    "begin" : "(?i)program(?-i)",
                    "end"   : "\\n",
                    "name" : "program-line.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "keyword.control.program.algoritmik" }
                    },
                    "endCaptures": {
                        "0": { "name": "null" }
                    },
                    "patterns": [
                        { "include": "#comment" },
                        { "include": "#program-name" }
                    ]
                },
                "program-name" : {
                    "match" : "\\W\\w*\\W",
                    "name" : "entity.name.function.program.algoritmik"
                }
            }
        },

        "function-procedure-section" : {
            "patterns": [
                { "include": "#function-line" },
                { "include": "#procedure-line"}
            ],
            "repository": {
                "function-line" : {
                    "begin" : "(?i)function(?-i)",
                    "end"   : "\\n",
                    "name" : "program-section.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "keyword.control.function.algoritmik" }
                    },
                    "patterns": [
                        { "include": "#comment"},
                        { "include": "#primitive-datatype"},
                        { "include": "#function-procedure-name" },
                        { "include": "#parameter-formal"},
                        { "include": "#function-return-operator"},
                        { "include": "#function-return-datatype"}
                    ]
                },
                "procedure-line" : {
                    "begin" : "(?i)procedure(?-i)",
                    "end"   : "\\n",
                    "name" : "program-section.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "keyword.control.function.algoritmik" }
                    },
                    "patterns": [
                        { "include": "#comment"},
                        { "include": "#function-procedure-name" },
                        { "include": "#parameter-formal"}
                    ]
                },
                "function-procedure-name" : {
                    "match" : "[_a-zA-Z][_a-zA-Z0-9]*(?=\\s*?\\()",
                    "name" : "entity.name.function.algoritmik"
                },

                "parameter-formal" : {
                    "begin" : "\\(",
                    "end" : "\\)",
                    "name": "parameter-formal.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "punctuation.parameter.parent.open.algoritmik" }
                    },
                    "endCaptures": {
                        "0": { "name": "punctuation.parameter.parent.close.algoritmik" }
                    },
                    "patterns" : [
                        { "include": "#parameter-name"},
                        { "include": "#parameter-datatype"}
                    ]
                },
                "parameter-name" : {
                    "match" : "(?<=[\\(\\,]\\s*?)[_a-zA-Z][_a-zA-Z0-9]*?(?=\\s*?(\\:|\\,))",
                    "name" : "variable.parameter.function.algoritmik"
                },
                "parameter-datatype": {
                    "match" : "(?<=\\:\\s*?)[_a-zA-Z][_a-zA-Z0-9]+(?=\\s*?(\\)|\\,))",
                    "name": "support.type.parameter.algoritmik"
                },
                "function-return-operator" : {
                    "match" : "\\-+?\\>",
                    "name": "keyword.operator.return.algoritmik"
                },
                "function-return-datatype" : {
                    "match" : "(?<=\\-+?\\>\\s*?)[_a-zA-Z][_a-zA-Z0-9]*",
                    "name": "support.type.return.algoritmik"
                }
            }
        },

        "kamus-section" : {
 
            "patterns": [
                { "include": "#kamus-block"}
            ],
            "repository" : {
                "kamus-block": {
                    "begin" : "(?i)(kamus lokal|kamus)(?-i)",
                    "end" : "\\b(?=(?i)algoritma(?-i))",
                    "name": "block.kamus.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "keyword.control.kamus.algoritmik" }
                    },
                    "patterns" : [
                        { "include": "#primitive-datatype"},
                        { "include": "#comment"},
                        { "include": "#variable-declaration"},
                        { "include": "#variable-datatype"}
                    ]
                },
                "variable-declaration" : {
                    "match": "(?<=\\s*)[_a-zA-Z][_a-zA-Z0-9]*?(?=\\s*?(\\:|\\,))",
                    "name": "variable.other.local.declaration.algoritmik"
                },
                "variable-datatype": {
                    "match" : "(?<=\\:\\s*?)[_a-zA-Z][_a-zA-Z0-9]+(?=\\W)",
                    "name": "support.type.declaration.algoritmik"
                }
                
            }
            
        },
        "algoritma-section": {
            "patterns": [
                { "include": "#algoritma-block"}
            ],
            "repository" : {
                "algoritma-block": {
                    "begin" : "(?i)algoritma(?-i)",
                    "end" : "\\b(?=(?i)(procedure|function|program)(?-i))",
                    "name": "block.algoritma.algoritmik",
                    "beginCaptures": {
                        "0": { "name": "keyword.control.algoritma.algoritmik" }
                    },
                    "patterns" : [
                    ]
                }
            }
        },

        "primitive-datatype": {
            "match" : "integer|boolean|real|character|array", 
            "name" : "storage.type.primitive.algoritmik"
        }

        
    }
}